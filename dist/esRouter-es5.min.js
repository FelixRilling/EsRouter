"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(a){var b=a.location;a.esRouter=function(){function a(b,c){_classCallCheck(this,a);var d=this;d.events={before:c.before,done:c.done,fail:c.fail,always:c.always},d.options={ajax:b.ajax||!1,log:b.log||!1},d.slug={preSlash:b.slug.preSlash||!1,postSlash:b.slug.postSlash||!1,urlFragmentInitator:"string"==typeof b.slug.urlFragmentInitator?b.slug.urlFragmentInitator:"#",urlFragmentAppend:"string"==typeof b.slug.urlFragmentAppend?b.slug.urlFragmentAppend:""},d.slug.built=(d.slug.preSlash?"/":"")+d.slug.urlFragmentInitator+d.slug.urlFragmentAppend,b.dataAttr=b.dataAttr||{},d.dom={getElements:function(a){for(var b=0;b<a.length;b++){var c=d.dom.dataAttr.buildAttr(d.dom.dataAttr.corePrefix,d.dom.dataAttr[a[b]]);d.dom.dataAttr.built[a[b]]=c,d.dom.elements[a[b]]=document.querySelectorAll("["+c[0]+"]")||[],d.isDefined(d.dom.elements[a[b]])||d.log(1,0,1,d.dom.elements[c[0]])}},dataAttr:{buildAttr:function(a,b){function c(a,b){return"data-"+a+"-"+b}function d(a,b){return a+b[0].toUpperCase()+b.substr(1)}return[c(a,b),d(a,b)]},types:["field","fieldDefault","link","pagination","source"],corePrefix:b.dataAttr.corePrefix||"router",field:b.dataAttr.field||"section",fieldDefault:b.dataAttr.fieldDefault||"default",link:b.dataAttr.link||"href",pagination:b.dataAttr.pagination||"pagin",source:b.dataAttr.pagination||"src",built:{}},elements:{}},d.data={active:null,activeId:null,defaultId:null,index:0}}return _createClass(a,[{key:"init",value:function(){function a(){if(c.isDefined(c.dom.elements.field)||c.log(0,0,0,c),c.isDefined(c.dom.elements.fieldDefault)){c.data.defaultId=c.dom.elements.fieldDefault[0].dataset[c.dom.dataAttr.built.field[1]];var a=c.slugGet();c.moveTo(a)}else c.log(0,0,0,c)}function b(){c.each(c.dom.elements.link,function(a){a.addEventListener("click",function(a){c.moveTo(a.target.dataset[c.dom.dataAttr.built.link[1]])})}),c.each(c.dom.elements.pagination,function(a){a.addEventListener("click",function(a){c.moveBy(parseInt(a.target.dataset[c.dom.dataAttr.built.pagination[1]]))})})}var c=this;c.dom.getElements(c.dom.dataAttr.types),a(),b()}},{key:"moveTo",value:function(a,b){function c(a){var b=d.findData(d.dom.elements.field,d.dom.dataAttr.built.field[1],a);return d.isDefined(b)?(d.data.activeId=a,d.data.active=b,d.data.index=d.getCurrentIndex(),!0):!1}var d=this;d.callback(d.events.before,[a,d]);var e=c(a);return e?(d.slugSet(d.data.activeId),d.options.ajax?d.getAJAX(d.data.active.dataset[d.dom.dataAttr.built.source[1]],function(a){d.data.active.innerHTML=a,d.callback(d.events.done,[d.data.active,d.data.activeId,d.data.index,d,a])}):d.callback(d.events.done,[d.data.active,d.data.activeId,d.data.index,d])):b?(d.callback(d.events.fail,[a,d]),d.log(0,1,1,this)):(d.log(1,1,0,a),d.moveTo(d.data.defaultId,!0)),d.callback(d.events.always,[d.data.active,d.data.activeId,d.data.index,d]),e}},{key:"moveBy",value:function(a){var b=this,c=b.data.index;return b.isDefined(b.dom.elements.field[c+a])?b.moveTo(b.dom.elements.field[c+a].dataset[b.dom.dataAttr.built.field[1]]):(b.log(2,1,0,a),!1)}},{key:"moveForward",value:function(){return this.moveBy(1)}},{key:"moveBackward",value:function(){return this.moveBy(-1)}},{key:"slugGet",value:function(a){var c=this;return b.href.lastIndexOf(this.slug.built)>-1?b.href.substr(b.href.lastIndexOf(c.slug.built)+c.slug.built.length+(c.slug.preSlash?1:0)):a?void c.log(1,1,1,this):(c.slugInit(c.data.defaultId),c.slugGet(!0))}},{key:"slugSet",value:function(a){b.href=b.href.substr(0,b.href.lastIndexOf(this.slug.built)+this.slug.built.length)+a}},{key:"slugInit",value:function(a){b.href=b.href+this.slug.built+a}},{key:"getCurrentIndex",value:function(){var a=this;return a.getElementIndex(a.dom.elements.field,a.data.active)}},{key:"getElementIndex",value:function(a,b){var c=void 0;return this.each(a,function(a,d){a===b&&(c=d)}),c}},{key:"findData",value:function(a,b,c){var d=void 0;return this.each(a,function(a){a.dataset[b]===c&&(d=a)}),d}},{key:"each",value:function(a,b){for(var c=0;c<a.length;c++)b(a[c],c)}},{key:"getAJAX",value:function(a,b){var c=this,d=new XMLHttpRequest;d.addEventListener("load",function(a){b(a.target.response)}),d.addEventListener("error",function(a){c.log(1,3,0,d)}),d.open("GET",a),d.send()}},{key:"callback",value:function(a,b){"function"==typeof a&&a.apply(this,b)}},{key:"isDefined",value:function(a){return"undefined"!=typeof a}},{key:"log",value:function(a,b,c,d){var e="esRouter: "+a+": "+b+"=>"+c+"= "+d;if(0===a)throw e;this.options.log}}]),a}()}(window);